{% extends 'hod_template/base_template.html' %}
{% block page_title %}
Home
{% endblock page_title %}
{% block main_content %}
    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
          <div class="row">
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-info">
              <div class="inner">
                <h3 id="std_count">{{ student_count }}</h3>

                <p>Total Students</p>
              </div>
              <div class="icon">
                <i class="ion ion-pie-graph"></i>
              </div>
              <a href="{% url 'manage_student' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-success">
              <div class="inner">
                <h3 id="stf_count">{{ staff_count }}</h3>

                <p>Total Staffs</p>
              </div>
              <div class="icon">
                <i class="ion ion-pie-graph"></i>
              </div>
              <a href="{% url 'manage_staff' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-warning">
              <div class="inner">
                <h3>{{ course_count }}</h3>

                <p>Total Course</p>
              </div>
              <div class="icon">
                <i class="ion ion-pie-graph"></i>
              </div>
              <a href="{% url 'manage_course' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-danger">
              <div class="inner">
                <h3>{{ subject_count }}</h3>

                <p>Total Subject</p>
              </div>
              <div class="icon">
                <i class="ion ion-pie-graph"></i>
              </div>
              <a href="{% url 'manage_subject' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
        </div>
          <div class="row">
              <div class="col-lg-6">
                <div class="card card-danger">
                  <div class="card-header">
                    <h3 class="card-title">Student and Staff Chart</h3>

                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                      </button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <canvas id="pieChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                  </div>
                  <!-- /.card-body -->
                </div>
              </div>
              <div class="col-lg-6">
                   <div class="card card-success">
                  <div class="card-header">
                    <h3 class="card-title">Total Subject in Each Courses</h3>

                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                      </button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <canvas id="donutChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                  </div>
                  <!-- /.card-body -->
                </div>
              </div>
          </div>
          <div class="row">
              <div class="col-lg-6">
                 <div class="card card-info">
                  <div class="card-header">
                    <h3 class="card-title">Total Student in Each Course</h3>

                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                      </button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <canvas id="pieChart2" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                  </div>
                  <!-- /.card-body -->
                </div>
              </div>
              <div class="col-lg-6">
                 <div class="card card-warning">
                  <div class="card-header">
                    <h3 class="card-title">Total Student in Each Subject</h3>

                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                      </button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <canvas id="donutChart2" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                  </div>
                  <!-- /.card-body -->
                </div>
              </div>
          </div>
          <div class="row">
              <div class="col-lg-12">
                  <div class="card card-success">
                  <div class="card-header">
                    <h3 class="card-title">Staff Leaves vs Attendance Takens</h3>

                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                      </button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chart">
                      <canvas id="barChart1" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                  </div>
                  <!-- /.card-body -->
                </div>
              </div>
          </div>
          <div class="row">
              <div class="col-lg-12">
                  <div class="card card-success">
                  <div class="card-header">
                    <h3 class="card-title">Student Leaves vs Attendance</h3>

                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                      </button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chart">
                      <canvas id="barChart2" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                  </div>
                  <!-- /.card-body -->
                </div>
              </div>
          </div>
          <div style="display: none;">
            <p id="course_cnt">{{ course_count }}</p>
            <ul id="std_course">
              {% for i in student_count_list_in_course %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <ul id="course_list">
              {% for i in course_name_list %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <p id="subj_cnt">{{ subject_count }}</p>
            <ul id="std_subject">
              {% for i in student_count_list_in_subject %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <ul id="subj_list">
              {% for i in subject_list %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <ul id="subj_course_cnt">
              {% for i in subject_count_list %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <ul id="staff_list">
              {% for i in staff_name_list %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <ul id="att_pre_staff">
              {% for i in attendance_present_list_staff %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <ul id="att_abs_staff">
              {% for i in attendance_absent_list_staff %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <ul id="student_list">
              {% for i in student_name_list %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <ul id="att_pre_student">
              {% for i in attendance_present_list_student %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
            <ul id="att_abs_student">
              {% for i in attendance_absent_list_student %}
              <li>{{ i }}</li>
              {% endfor %}
            </ul>
          </div>
      </div>
    </section>
    <!-- /.content -->
{% endblock main_content %}
{% block custom_js %}
<script>
    $(document).ready(function(){
      const allColors = ['#f56954', '#00a65a', '#aa00ff', '#bf360c', '#ffff00', '#987070', '#00e676', '#40c4ff', '#3498db', '#F1E5D1',  '#9b59b6', '#1abc9c', '#FED8B1',  '#7f8c8d', '#2ecc71', '#e67e22', '#2980b9', '#8e44ad', '#c0392b','#F6EEC9'];
        var std_count = document.getElementById("std_count").textContent;
        var stf_count = document.getElementById("stf_count").textContent;

        var pieData = {
            labels: [ 'Students','Staffs'],
            datasets: [{
                data: [std_count,stf_count],
                backgroundColor : allColors.slice(0, 2),
            }]
        };

        var pieChartCanvas = $('#pieChart').get(0).getContext('2d')
        var pieOptions     = {
            maintainAspectRatio : false,
            responsive : true,
        }

        var pieChart = new Chart(pieChartCanvas, {
            type: 'pie',
            data: pieData,
            options: pieOptions
        });

        var course_len = document.getElementById("course_cnt").textContent;
        var data = document.getElementById("course_list");
        var data0 = document.getElementById("subj_course_cnt");
        
        const course_list = Array.from(data.querySelectorAll('li')).map(li =>li.textContent);
        const subj_course_cnts = Array.from(data0.querySelectorAll('li')).map(li => parseInt(li.textContent, 10));
        console.log(subj_course_cnts)

        var donutChartData = {
            labels: course_list,
            datasets: [{
                data: subj_course_cnts,
                backgroundColor : allColors.slice(3,3+course_len),
            }]
        };

        var donutChartCanvas = $('#donutChart').get(0).getContext('2d')
        var donutChartOptions     = {
            maintainAspectRatio : false,
            responsive : true,
        }

        var donutChart = new Chart(donutChartCanvas, {
            type: 'doughnut',
            data: donutChartData,
            options: donutChartOptions
        });
        
        var data1 = document.getElementById("std_course");

        const std_course = Array.from(data1.querySelectorAll('li')).map(li => parseInt(li.textContent, 10));

        var pieData3 = {
            labels: course_list,
            datasets: [{
                data: std_course,
                backgroundColor : allColors.slice(11, 11+course_len),
            }]
        };

        var pieChartCanvas3 = $('#pieChart2').get(0).getContext('2d')
        var pieOptions3     = {
            maintainAspectRatio : false,
            responsive : true,
        }

        var pieChart3 = new Chart(pieChartCanvas3, {
            type: 'pie',
            data: pieData3,
            options: pieOptions3
        });

        var subject_len = document.getElementById("subj_cnt").textContent;
        var data2 = document.getElementById("std_subject");
        var data3 = document.getElementById("subj_list");

        const std_subject = Array.from(data2.querySelectorAll('li')).map(li => parseInt(li.textContent, 10));
        const subj_list = Array.from(data3.querySelectorAll('li')).map(li =>li.textContent);

        var donutChartData2 = {
            labels: subj_list,
            datasets: [{
                data: std_subject,
                backgroundColor : allColors.slice(3, 3+subject_len),
            }]
        };

        var donutChartCanvas2 = $('#donutChart2').get(0).getContext('2d')
        var donutChartOptions2     = {
            maintainAspectRatio : false,
            responsive : true,
        }

        var pieChart4 = new Chart(donutChartCanvas2, {
            type: 'doughnut',
            data: donutChartData2,
            options: donutChartOptions2
        });

        var staff_names = document.getElementById("staff_list");
        var data4 = document.getElementById("att_pre_staff");
        var data5 = document.getElementById("att_abs_staff");

        const staff_name_list = Array.from(staff_names.querySelectorAll('li')).map(li =>li.textContent);
        const staff_pre = Array.from(data4.querySelectorAll('li')).map(li => parseInt(li.textContent, 10));
        const staff_abs = Array.from(data5.querySelectorAll('li')).map(li => parseInt(li.textContent, 10));

        var barChartData = {
          labels: staff_name_list,
          datasets: [{
            label               : 'Leaves',
            backgroundColor     : 'rgba(60,141,188,0.9)',
            borderColor         : 'rgba(60,141,188,0.8)',
            pointRadius          : false,
            pointColor          : '#3b8bba',
            pointStrokeColor    : 'rgba(60,141,188,1)',
            pointHighlightFill  : '#fff',
            pointHighlightStroke: 'rgba(60,141,188,1)',
            data                : staff_abs
            },
            {
              label               : 'Attendance Takens',
              backgroundColor     : 'rgba(210, 214, 222, 1)',
              borderColor         : 'rgba(210, 214, 222, 1)',
              pointRadius         : false,
              pointColor          : 'rgba(210, 214, 222, 1)',
              pointStrokeColor    : '#c1c7d1',
              pointHighlightFill  : '#fff',
              pointHighlightStroke: 'rgba(220,220,220,1)',
              data                : staff_pre
            },
          ]
        }

        var barChartCanvas = $('#barChart1').get(0).getContext('2d')
        var temp0 = barChartData.datasets[0]
        var temp1 = barChartData.datasets[1]
        barChartData.datasets[0] = temp1
        barChartData.datasets[1] = temp0

        var barChartOptions = {
          responsive              : true,
          maintainAspectRatio     : false,
          datasetFill             : false
        }

        var barChart = new Chart(barChartCanvas, {
          type: 'bar',
          data: barChartData,
          options: barChartOptions
        });

        var student_names = document.getElementById("student_list");
        var data6 = document.getElementById("att_pre_student");
        var data7 = document.getElementById("att_abs_student");

        const student_name_list = Array.from(student_names.querySelectorAll('li')).map(li =>li.textContent);
        const student_pre = Array.from(data6.querySelectorAll('li')).map(li => parseInt(li.textContent, 10));
        const student_abs = Array.from(data7.querySelectorAll('li')).map(li => parseInt(li.textContent, 10));

        console.log(student_abs,student_name_list,student_pre);
        var barChartData2 = {
          labels: student_name_list,
          datasets: [{
            label               : 'Leaves',
            backgroundColor     : 'rgba(60,141,188,0.9)',
            borderColor         : 'rgba(60,141,188,0.8)',
            pointRadius          : false,
            pointColor          : '#3b8bba',
            pointStrokeColor    : 'rgba(60,141,188,1)',
            pointHighlightFill  : '#fff',
            pointHighlightStroke: 'rgba(60,141,188,1)',
            data                : student_abs
            },
            {
              label               : 'Attendance',
              backgroundColor     : 'rgba(210, 214, 222, 1)',
              borderColor         : 'rgba(210, 214, 222, 1)',
              pointRadius         : false,
              pointColor          : 'rgba(210, 214, 222, 1)',
              pointStrokeColor    : '#c1c7d1',
              pointHighlightFill  : '#fff',
              pointHighlightStroke: 'rgba(220,220,220,1)',
              data                : student_pre
            },
          ]
        }

        var barChartCanvas2 = $('#barChart2').get(0).getContext('2d')
        var temp02 = barChartData2.datasets[0]
        var temp12 = barChartData2.datasets[1]
        barChartData2.datasets[0] = temp12
        barChartData2.datasets[1] = temp02

        var barChartOptions2 = {
          responsive              : true,
          maintainAspectRatio     : false,
          datasetFill             : false
        }

        var barChart2 = new Chart(barChartCanvas2, {
          type: 'bar',
          data: barChartData2,
          options: barChartOptions2
        })

    });
</script>
{% endblock custom_js %}